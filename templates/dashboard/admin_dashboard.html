{% extends 'base.html' %}

{% block title %}Admin Dashboard - BotanIQ{% endblock %}

{% block content %}
<div class="container fade-in">
    <!-- Header -->
    <div style="text-align: center; margin-bottom: 3rem;">
        <h1 style="font-family: var(--font-heading); color: var(--primary-green); margin-bottom: 1rem;">
            Admin Dashboard
        </h1>
        <p style="color: var(--text-medium); font-size: 1.1rem;">
            Comprehensive platform management and analytics for BotanIQ.
        </p>
    </div>

    <!-- Key Metrics Overview -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 3rem;">
        <!-- Plants -->
        <div class="card" style="text-align: center;">
            <div class="card-content">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸŒ¿</div>
                <h3 style="font-size: 1.8rem; color: var(--primary-green); margin-bottom: 0.5rem;">{{ total_plants }}</h3>
                <p style="color: var(--text-medium); font-size: 0.9rem;">Total Plants</p>
                <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 0.5rem;">
                    <small style="color: var(--success);">{{ verified_plants }} verified</small>
                    <small style="color: var(--warning);">{{ unverified_plants }} pending</small>
                </div>
            </div>
        </div>

        <!-- Users -->
        <div class="card" style="text-align: center;">
            <div class="card-content">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ‘¥</div>
                <h3 style="font-size: 1.8rem; color: var(--primary-green); margin-bottom: 0.5rem;">{{ total_users }}</h3>
                <p style="color: var(--text-medium); font-size: 0.9rem;">Total Users</p>
                <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 0.5rem;">
                    <small style="color: var(--success);">{{ active_users }} active</small>
                    <small style="color: var(--accent-green);">{{ staff_users }} staff</small>
                </div>
            </div>
        </div>

        <!-- Engagement -->
        <div class="card" style="text-align: center;">
            <div class="card-content">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ“š</div>
                <h3 style="font-size: 1.8rem; color: var(--primary-green); margin-bottom: 0.5rem;">{{ total_saved_plants }}</h3>
                <p style="color: var(--text-medium); font-size: 0.9rem;">Saved Plants</p>
                <small style="color: var(--text-light);">{{ total_collections }} collections</small>
            </div>
        </div>

        <!-- Activity -->
        <div class="card" style="text-align: center;">
            <div class="card-content">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ“ˆ</div>
                <h3 style="font-size: 1.8rem; color: var(--primary-green); margin-bottom: 0.5rem;">{{ new_users_7d }}</h3>
                <p style="color: var(--text-medium); font-size: 0.9rem;">New Users (7d)</p>
                <small style="color: var(--text-light);">{{ new_plants_7d }} new plants</small>
            </div>
        </div>
    </div>

    <!-- Activity Trends -->
    <div style="margin-bottom: 3rem;">
        <h2 style="font-family: var(--font-heading); color: var(--primary-green); margin-bottom: 2rem;">Recent Activity</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div class="card" style="text-align: center;">
                <div class="card-content">
                    <h4 style="color: var(--primary-green); margin-bottom: 0.5rem;">Last 30 Days</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <div style="font-size: 1.5rem; color: var(--accent-green);">{{ new_users_30d }}</div>
                            <small style="color: var(--text-medium);">New Users</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--accent-green);">{{ new_plants_30d }}</div>
                            <small style="color: var(--text-medium);">New Plants</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--accent-green);">{{ saved_plants_30d }}</div>
                            <small style="color: var(--text-medium);">Saves</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--accent-green);">{{ total_research_notes }}</div>
                            <small style="color: var(--text-medium);">Notes</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="text-align: center;">
                <div class="card-content">
                    <h4 style="color: var(--primary-green); margin-bottom: 0.5rem;">User Engagement</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <div style="font-size: 1.5rem; color: var(--accent-green);">{{ users_with_saved_plants }}</div>
                            <small style="color: var(--text-medium);">Active Savers</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--accent-green);">{{ users_with_collections }}</div>
                            <small style="color: var(--text-medium);">Have Collections</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--accent-green);">{{ avg_plants_per_user }}</div>
                            <small style="color: var(--text-medium);">Avg Plants/User</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--accent-green);">{{ total_collections }}</div>
                            <small style="color: var(--text-medium);">Collections</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="text-align: center;">
                <div class="card-content">
                    <h4 style="color: var(--primary-green); margin-bottom: 0.5rem;">System Health</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <div style="font-size: 1.5rem; color: var(--error);">{{ plants_without_description }}</div>
                            <small style="color: var(--text-medium);">No Description</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--error);">{{ plants_without_uses }}</div>
                            <small style="color: var(--text-medium);">No Uses</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--success);">{{ verified_plants }}</div>
                            <small style="color: var(--text-medium);">Verified</small>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; color: var(--warning);">{{ unverified_plants }}</div>
                            <small style="color: var(--text-medium);">Unverified</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Management Actions -->
    <div style="margin-bottom: 3rem;">
        <h2 style="font-family: var(--font-heading); color: var(--primary-green); margin-bottom: 2rem;">Management Tools</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div class="card">
                <div class="card-content">
                    <h3 style="color: var(--primary-green); margin-bottom: 1rem;">Content Management</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <a href="{% url 'dashboard:admin_plants' %}" class="btn btn-primary" style="font-size: 0.9rem;">Manage Plants</a>
                        <a href="{% url 'dashboard:admin_add_plant' %}" class="btn btn-secondary" style="font-size: 0.9rem;">Add Plant</a>
                        <a href="{% url 'admin:index' %}" class="btn btn-secondary" style="font-size: 0.9rem;">Django Admin</a>
                        <a href="{% url 'plants:plant_list' %}" class="btn btn-secondary" style="font-size: 0.9rem;">View Public</a>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-content">
                    <h3 style="color: var(--primary-green); margin-bottom: 1rem;">User Management</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <a href="{% url 'dashboard:admin_users' %}" class="btn btn-primary" style="font-size: 0.9rem;">View Users</a>
                        <a href="{% url 'admin:auth_user_changelist' %}" class="btn btn-secondary" style="font-size: 0.9rem;">User Admin</a>
                        <a href="{% url 'register' %}" class="btn btn-secondary" style="font-size: 0.9rem;">Create User</a>
                        <a href="{% url 'dashboard:dashboard' %}" class="btn btn-secondary" style="font-size: 0.9rem;">User Dashboard</a>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-content">
                    <h3 style="color: var(--primary-green); margin-bottom: 1rem;">Data & Analytics</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn btn-secondary" style="font-size: 0.9rem;" onclick="alert('Export feature coming soon')">Export Data</button>
                        <button class="btn btn-secondary" style="font-size: 0.9rem;" onclick="alert('Reports feature coming soon')">Generate Report</button>
                        <button class="btn btn-secondary" style="font-size: 0.9rem;" onclick="window.location.reload()">Refresh Stats</button>
                        <button class="btn btn-secondary" style="font-size: 0.9rem;" onclick="alert('Backup feature coming soon')">Backup Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Insights -->
    <div style="margin-bottom: 3rem;">
        <h2 style="font-family: var(--font-heading); color: var(--primary-green); margin-bottom: 2rem;">Content Insights</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
            <!-- Regions -->
            <div class="card">
                <div class="card-content">
                    <h3 style="color: var(--primary-green); margin-bottom: 1.5rem;">Plants by Region</h3>
                    {% if plants_by_region %}
                        {% for item in plants_by_region %}
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--bg-secondary);">
                                <span>{{ item.regions|join:", " }}</span>
                                <span style="background: var(--accent-green); color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8rem;">{{ item.count }}</span>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p style="color: var(--text-medium); font-style: italic;">No regional data available.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Traditional Systems -->
            <div class="card">
                <div class="card-content">
                    <h3 style="color: var(--primary-green); margin-bottom: 1.5rem;">Plants by Traditional System</h3>
                    {% if plants_by_system %}
                        {% for item in plants_by_system %}
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--bg-secondary);">
                                <span>{{ item.traditional_systems|join:", " }}</span>
                                <span style="background: var(--accent-green); color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8rem;">{{ item.count }}</span>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p style="color: var(--text-medium); font-style: italic;">No system data available.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity Feed -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
        <!-- Recent Plants -->
        <div class="card">
            <div class="card-content">
                <h3 style="color: var(--primary-green); margin-bottom: 1.5rem;">Recently Added Plants</h3>
                {% if recent_plants %}
                    {% for plant in recent_plants %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--bg-secondary);">
                            <div>
                                <strong>{{ plant.get_primary_common_name }}</strong>
                                <br><small style="color: var(--text-medium);">{{ plant.scientific_name }}</small>
                                {% if not plant.is_verified %}
                                    <span style="background: var(--warning); color: white; padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.7rem; margin-left: 0.5rem;">Unverified</span>
                                {% endif %}
                            </div>
                            <div style="text-align: right;">
                                <a href="{% url 'dashboard:admin_edit_plant' plant.id %}" class="btn" style="font-size: 0.8rem; padding: 0.3rem 0.8rem; margin-bottom: 0.3rem;">Edit</a>
                                <br><small style="color: var(--text-light);">{{ plant.created_at|date:"M j, Y" }}</small>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p style="color: var(--text-medium); font-style: italic;">No plants added yet.</p>
                {% endif %}
            </div>
        </div>

        <!-- Recent Users -->
        <div class="card">
            <div class="card-content">
                <h3 style="color: var(--primary-green); margin-bottom: 1.5rem;">Recent User Registrations</h3>
                {% if recent_users %}
                    {% for user in recent_users %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--bg-secondary);">
                            <div>
                                <strong>{{ user.username }}</strong>
                                <br><small style="color: var(--text-medium);">{{ user.email|default:"No email" }}</small>
                                {% if user.is_staff %}
                                    <span style="background: var(--error); color: white; padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.7rem; margin-left: 0.5rem;">Staff</span>
                                {% endif %}
                            </div>
                            <div style="text-align: right;">
                                <small style="color: var(--text-light);">{{ user.date_joined|date:"M j, Y" }}</small>
                                {% if not user.is_active %}
                                    <br><span style="background: var(--warning); color: white; padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.7rem;">Inactive</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p style="color: var(--text-medium); font-style: italic;">No recent registrations.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
